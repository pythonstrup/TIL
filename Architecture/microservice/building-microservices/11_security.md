# Chapter 11. 보안

- 애플리케이션 보안 분야는 여전히 전문가의 지원이 필요하지만, 그들의 도움을 받더라도 이러한 주제와 관련해 기초 지식을 갖추는 것은 여전히 중요하다.
- 마이크로서비스는 시스템의 보안을 약화시킬 수도 있고 강화할 수도 있다.

## 1. 핵심 원칙

- 보안 문제는 가장 안전하지 않은 측면만큼만 안전하다.
  - 비유: 뒷문을 열어둔 채 강력한 정문을 만드는 것.

### 1-1. 최소 권한의 원칙

- 개인, 외부 또는 내부 시스템, 심지어 자체 마이크로서비스에 액세스 권한을 부여할 때는 부여하는 액세스 권한에 주의를 기울여야 한다.
- `최소 권한의 원칙 principle of least privilege`은 액세스 권한을 부여할 때 당사자가 필요한 기능을 수행하는 데 필요한 최소힌의 액세스 권한을 필요한 기간 동안만 부여한다는 개념을 설명한다.
- 최소 권한의 원칙은 제한된 시간 동안만 액세스 제어를 부여하도록 확장해 탈취될 경우 악영향을 더욱 제한할 수 있다.

### 1-2. 심층 방어

- 보호 메커니즘이 하나만 있는 것 
  - 그 방어를 무력화할 수 있다면 문제가 된다.
  - 혹은 특정 유형에 대해서만 방어할 때 문제가 된다.
- 여러 보호 장치를 갖추는 것은 굉장히 중요하다.

> #### 보안 통제 유형
> 1. 예방형 preventive
> - 공격이 발생하지 않도록 방지. secret을 안전하게 저장. 저장 및 전송 중인 데이터를 암호화. 적절한 인증 및 권한 부여 메커니즘 구현.
> 2. 탐지형 detective
> - 공격이 발생하고 있거나 발생했다는 사실을 알려준다. 애플리케이션 방화벽과 침입 탐지 서비스가 좋은 예시.
> 3. 대응형 reponsive
> - 공격 중 또는 공격 후 대응을 돕는다. 시스템 재구축 자동화 메커니즘. 데이터 복구를 위한 백업 작업.

### 1-3. 자동화

- 마이크로서비스 아키텍처에서 동작 부분이 훨씬 더 많아지면서 자동화는 점점 더 복합해지는 시스템을 관리하기 위한 핵심이 됐다.
  - 컴퓨터는 인간보다 동일한 작업을 반복해서 수행하는 데 훨씬 더 뛰어나다.
- 예를 들어, 특정 스크립트에 특정 권한만 할당하면 인적 오류는 줄이고 최소 권한 원칙을 더 쉽게 구현할 수 있다. 

### 1-4. 제공 프로세스에 보안 주입

- `소프트웨어 제공 software delivery`의 다른 측면과 마찬가지로 보안은 사후에 고려되는 사항으로 간주되는 경우가 너무 흔하다.
- 보안은 종종 소프트웨어를 외부로 내보는는 데 방해가 되는 것으로 여겨져 왔다.
- 하지만 보안도 다른 요소와 다르지 않음.

<br/>

## 2. 사이버 보안의 다섯 가지 기능

- 사이버 보안과 관련된 다양한 활동에 대한 유용한 5개의 모델
1. 잠재적인 공격자가 누구인지, 공격 대상이 무엇인지, 가장 취약한 곳은 어디인지 `식별하라`.
2. 잠재적인 해커로부터 주요 자산을 `보호하라`.
3. 최선의 노력에도 불구하고 공격이 발생했는지 `감지하라`.
4. 나쁜 일이 발생했다는 것을 알게 되면 `대응하라`.
5. 사고 발생 후 `복구하라`.

### 2-1. 식별

- 무엇을 보호해야 하는지 파악하기 전에 누가 우리 것을 노리고 있는지, 그들이 정확히 무엇을 찾고 있는지 알아야 한다.
  - `위협 모델링 threat modeling`
- 눈에 보이는 기술적 문제에 대한 기술적 해결책에는 쉽게 도달한다.
  - 하지만 우리는 모두 제한된 시각으로 바라본다는 문제가 있다.
- 공격자의 입장이 되어 외부에서 내부를 들여다보는 것이 중요하다.
  - 외부인의 관점이 중요. 외부의 도움을 받아 위협 모델링 작업을 진행하는 것이 매우 유용

### 2-2. 보호

- 마이크로서비스 아키텍처는 공격할 수 있는 표면적이 훨씬 넓기 때문에 보호해야 할 대상도 많지만, 심층 방어를 위한 많은 방법이 있다.

### 2-3. 탐지

- 마이크로서비스에서의 장애 감지는 복잡하다. => 모니터링해야 할 네트워크와 감시해야 할 기계가 더 많기 때문에.
- 또한 원천 정보가 크게 증가해 문제 탐지가 더욱 어려워질 수 있다. => 로그 집계가 도움이 된다.
- 그 외에도 불량 행위를 탐지하는 `침입 탐지 intrusion detection` 시스템과 같은 특수한 도구가 존재.

### 2-4. 대응

- 최악의 상황이 발생했다면?
  - 효과적인 사고 대응을 위한 접근법을 이해하는 것은 침해로 인한 손상을 제한하는 데 필수적이다.
- 많은 조직에서 침해 사고의 여파에 잘못 대응함으로써 침해로 인한 영향을 더욱 학화시켜 재정적 처벌이 가중되는 경우가 많다.

### 2-5. 복구

- 공격 발생 후 시스템을 가동하고 실행하는 능력. 문제가 재발되지 않도록 배운 것을 구현하는 능력.

<br/>

## 3. 애플리케이션 보안의 기초

- 자격 증명, 패치, 백업, 재구축

### 3-1. 자격 증명

- `자격 증명 credentials`은 사람(또는 컴퓨터)에게 어떤 형태의 제한된 자원에 대한 액세스 권한을 부여한다.
- 자격 증명은 두 가지 주요 영역으로 나눠서 생각해볼 수 있다.
1. 시스템 사용자(그리고 운영자)의 자격증명
   - 시스템의 가장 약한 지점. 악의적 당사자의 `공격 벡터 attack vector`로 흔히 사용
2. 마이크로서비스를 실행하는 데 중요한 정보인 시크릿

- 두 자격 증명 모두 `교체 rotation`, `폐기 revocation`, `권한 제한 limiting scope`의 문제를 고려해야 한다.

#### 사용자 자격 증명

- 해킹으로 인한 사건의 80%에서 어떤 형태의 자격 증명 탈취가 이뤄짐.
  - `피싱 phishing`, `패스워드 무작위 brute-forced` 공격 메커니즘 등을 사용
- API가 주도하는 시스템의 시대에서 자격 증명은 제삼자 시스템을 위한 API 키와 같은 것을 관리하도록 확장.

#### 시크릿

- 마이크로서비스가 작동하는 데 필수적 정보.
  - TLS용 인증서
  - SSH 키
  - 공개/비공개 API 키 쌍
  - 데이터베이스 액세스를 위한 자격 증명
- 시크릿의 수명주기를 고려하면 다양한 보안 요구 사항이 필요한 암호 관리의 다양한 측면을 구분해 볼 수 있다.
  - `creation`: 처음에 시크릿을 어떻게 만드는가?
  - `distribution`: 시크릿이 생성된 후 어떻게 올바른 장소에(만) 전달되도록 할 수 있는가?
  - `storage`: 권한을 가진 당사자만 액세스할 수 있도록 시크릿이 저장돼 있는가?
  - `monitoring`: 이 시크릿이 어떻게 사용되고 있는지 아는가?
  - `rotation`: 문제없이 스크릿을 변경할 수 있는가?
- 쿠버네티스는 자체 내장된 시크릿 솔루션을 제공.

#### 교체

- 자격 증명을 자주 교체해 누군가 자격 증명에 액세스했을 때 발생할 수 있는 피해를 제한하는 것이 이상적.

#### 폐기

- 긴급 폐기를 처리할 수 있도록 설정

#### 범위 제한

- 자격 증명의 범위를 제한하는 것은 최소 권한 원칙을 수용하는 개념의 핵심이다.

### 3-2. 패치

- 에퀴팩스의 데이터 유출 사건
  - 아파치 스트러츠의 취약점을 확인해 문제를 수정한 관리자가 새 릴리스를 만들었음에도 불구하고 소프트웨어를 업데이트하지 않았다.
- 대규모 환경에서 어떤 마이크로서비스가 알려진 취약성이 있는 라이브러리에 연결돼 있는지 파악하는 것은 매우 어려울 수 있다.
  - `Snyk`나 `Github Code Scanning`과 같은 도구를 사용.

### 3-3. 백업

- 백업을 하는 것 = 치실질을 하는 것.
- 데이터의 가치는 그 어느 때보다 높지만, 기술의 발전으로 인해 백업의 우선순위가 낮아진 것을 아닐까하는 의문.
  - 디스크는 과거보다 안정적. 데이터베이스는 데이터 손실을 방지하기 위해 내장된 복제 기능이 제공될 가능성 높음. 
  - 이런 시스템을 사용하면 백업이 필요하지 않다고 느낄지도 모른다.
- 하지만 치명적인 오류가 발생해 전체 `Cassandra` 클러스터가 지워진다면?
- 코딩 버그로 인해 애플리케이션이 중요한 데이터를 삭제해버렸다면?
- 따라서 중요한 데이터는 항상 백업해둬야 한다. 

### 3-4. 재구축

- 공격이 발생했을 때 해야할 일? 승인되지 않은 당사자의 액세스 권한을 제거하는 일. => 하지만 생각보다 간단하지 않다.
- 존재하는 서버를 지우고 완전히 재구축하는 능력은 알려진 공격뿐 아니라 지속적인 공격자의 영향을 줄이는 측면에서도 상당히 효과적일 수 있다.
- 시스템에 악의적인 당사자가 있는지 알지 못할 수 있지만 정기적으로 서버를 재구축하고 자격 증명을 교체한다면 깨닫지 못하는 사이에 공격자가 할 수 있는 일의 영향을 크게 제한할 수 있다.
 
<br/>

## 4. 암묵적 신뢰 대 제로 트러스트

<br/>

## 5. 데이터 보안

<br/>

## 6. 인증 및 권한 부여

<br/>

# 참고 자료

- 마이크로서비스 아키텍처 구축, 샘 뉴먼 지음
