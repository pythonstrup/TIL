# Chapter15. 조직 구조

- 마이크로서비스를 사용하려면 회사의 조직도를 무시해야 할 수 있다.

## 1. 느슨하게 결합된 조직

- 조직 구조의 변화 없이 이뤄지는 마이크로서비스 아키텍처로의 전환은 마이크로서비스의 유용성을 둔화시킬 것이다.
  - 일반적으로 팀 간의 조정을 줄여 제공 속도를 높이고, 이를 통해 팀 스스로 더 많은 의사결정을 내릴 수 있도록 해야 한다.

> #### 니콜 폴그스렌, 제즈 험블, 진 킴 "디질털 트랜스포메이션 엔진: 고성과 기술 조직 구축 및 진화"
> - 팀은 팀 외부 누군가의 허가 없이 시스템 설계에 대규모 변경을 가할 수 있다.
> - 팀은 시스템을 변경하는 과정에서 다른 팀에 의존하지 않거나 다른 팀을 위해 중요한 작업을 수행하지 않고도 시스템 설계에 대규모 변경을 가할 수 있다.
> - 팀은 팀 외부의 사람들과 소통하거나 조정하지 않고도 작업을 완료할 수 있다.
> - 팀은 의존하는 다른 서비스에 관계없이 필요에 따라 제품과 서비스를 배포하고 릴리스할 수 있다.
> - 팀은 통합된 테스트 환경 없이도 대부분의 테스트를 필요에 따라 수행할 수 있다.
> - 팀은 다운타임이 거의 없이 정상 업무 시간 동안 배포를 수행할 수 있다.

## 2. 콘웨이 법칙

> 시스템을 설계하는 조직은 필연적으로 그 조직의 소통 구조와 닮은 설계를 한다.

### 2-1. 증거

#### 느슨하거나 강하게 결합되 조직

- 강하게 결합된 조직은 일반적으로 확실하게 정렬된 비전과 목표를 설정한 상용 제품 회사로 간주된다.
- 느슨하게 결합된 조직은 분산된 오픈 소스 커뮤니티로 잘 대표된다.

#### 윈도우 비스타

- 마이크로소프트는 조직 구조 자체가 윈도우 비스타 품질에 어느 정도 영향을 미치는지 알아보고자 실증적 연구를 수행했다.
  - 코드 복잡성과 같이 일반적으로 사용되는 소프트웨어 품질 지표 등을 고려한 결과 조직 구조가 가장 관련성 높은 요소라는 사실을 알아냈다.

#### 넷플릭스와 아마존

- 조직과 아키텍처가 정렬돼야 한다는 생각과 관련된 대표적인 사례는 아마도 아마존과 넷플릭스일 것.
- 아마존
  - 초기에 시스템의 전체 수명주기를 소유한 팀의 장점을 이해하기 시작.
  - 팀이 담당하는 전체 수명주기를 관리하면서 시스템을 소유하고 운영하길 원했다.
  - 작은 팀 선호. 피자 두 판이 부족할 정도로 팀이 크면 안 된다. => `피자 두 판 팀 two-pizza team`
  - 최적의 팀 규모는 8~10명이며 이 팀은 고객에 대응해야 한다는 것이 일반적인 생각.
- 넷플릭스
  - 아마존의 사례를 교훈 삼아 처음부터 작고 독립적인 팀을 중심으로 조직.
  - 이를 통해 시스템의 아키텍처가 변화의 속도에 맞게 최적화됐다.

## 3. 팀 규모

- '이상적인' 팀의 인원 수를 물어보면 대체로 5~10명 사이로 답변.
- 아홉 명 이상인 프로젝트에서 생산성이 가장 낮다는 연구 결과

## 4. 콘웨이의 법칙 이해

> 만약 느슨하게 결합되고 잘 캡슐화된 아키텍처와 그에 맞는 조직 구조를 만든다면, 두 가지 중요한 일이 일어난다.
> 첫째, 속도와 안정성을 모두 높이는 동시에 번아웃과 배포의 어려움을 감소시키면서 더 나은 전달 성과를 만들 수 있다.
> 둘째, 엔지니어링 조직의 규모를 크게 키우면서 생산성을 선형적으로 증가시키거나 선형적인 것보다 더 크게 증가시킬 수 있다.

- 조직을 확장하면서도 여전히 기민하게 움직이려면, 중앙 집중식 의사결정을 세붖ㄴ화하고 의사결정을 더 많은 자율성을 갖고 운영할 수 있는 조직의 부소로 이양해 책임을 보다 효과적으로 분산해야 한다는 사실을 점점 더 많은 조직이 인식하고 있다.

## 5. 소규모 팀, 대규모 조직

> 지연된 소프트웨어 프로젝트에 인력을 추가하면 더 지연된다.
> - 프레드 브룩스 (브룩스의 법칙)

- 더 많은 사람을 문제에 투입해 더 빨리 진행하려면 작업을 병렬로 수행할 수 있는 작업으로 분할할 수 있어야 한다.
- 소프트웨어 제공 과정에서 효율적으로 대규모 작업을 하는 데 가장 비용이 많이 드는 것은 조정 활동의 필요성이다.
  - 조정이 많을수록 진행 속도는 더 느려진다.
- 팀이 더 큰 조직에 맞추는 방법을 찾는 것이 중요하다.
  - `팀 API`의 개념.

> 팀 API는 다른 팀이 편리하게 활용할 수 있도록 다음 사항들을 고려해야 한다.
> 다른 팀들은 팀 API를 쉽게 찾고 간단하게 사용할 수 있을까? 아니면 사용하기 어렵고 혼란스러울까?
> 새로운 팀이 코드와 업무 관행에 얼마나 쉽게 적응할 수 있을까?
> 다른 팀의 pull 요청이나 제안에 어떻게 대응하는가? 다른 팀이 우리 팀의 `백로그 backlog`나 제품 로드맵을 쉽게 이해할 수 있는가?

## 6. 자율성에 관해

> 어떤 산업에 종사하든, 모든 것은 사람들에게 달려 있다. 
> 그리고 그들이 제대로 잘하고 있는지 확인하고, 진정한 잠재력을 발휘할 수 있도록 자신감과 동기 부여, 자유와 열정을 제공하는 것이다.
> - 좀 팀슨

- 소규모 사업 조직이 동작하려면 자율적인 단위로 작동할 수 있는 권한과 책임이 부여돼야 한다.
- 로빈 던바의 연구 (사회 집단을 형성하는 인간 능력을 연구)
  - 인간의 인지 능력은 다양한 형태의 사회적 관계를 얼마나 효과적으로 유지할 수 있는지에 따라 한계가 있다.
  - 한 집단이 분리되기 전까지 성장할 수 있는 인원을 150명으로 추청. 초과할 경우 그 자체의 무게로 인해 붕괴.
- 팀의 자율성이 올바르게 수행된다면, 사람들이 권한을 부여받고, 한 단계 더 성장하고, 업무를 더 빨리 완수할 수 있다.
  - 팀이 마이크로서비스를 소유하고 완전히 통제할 수 있다면 더 큰 조직 안에서 더 많은 자율성을 가질 수 있다.

## 7. 강력한 소유권 vs 공동 소유권

### 7-1. 강력한 소유권

- `강력한 소유권 strong ownership`에서는 서비스를 소유한 팀이 결정을 내린다.

> 널리 알려진 아마존의 '피자 두 판 팀'에 대해 대부분의 사람들이 핵심을 놓치고 있다.
> 그것은 팀의 크기에 관한 말이 아니다. 오히려 팀의 자율성, 책임, 기업가 정신에 관한 것이다.
> 피자 두 판 팀은 조직 내 소규모 팀이 독립적이고 민첩하게 운영할 수 있는 환경을 조성하는 것과 관련이 있다.

- 강력한 소유권 모델은 국부적 편차를 더 많이 허용할 수 있다.
- 기본적으로 더 강력한 모델을 채택할수록 조정이 덜 필요하므로 팀의 생산성은 더 향상될 수 있다.

#### 강력한 소유권은 어디까지인가?

- 전체 수명주기 소유권
  - 단일 팀이 설계를 제시. 변경을 수행. 마이크로서비스 배포. 운영 환경에서 관리.
  - 더 이상 필요하지 않을 때는 최종적으로 마이크로서비스를 폐기
- 외부와 조정할 필요 X => 팀의 자율성 상승
  - 배포를 위해 운영 팀에 티켓을 올리지 않아도 되고, 외부 당사자가 변경 사항을 승인하지 않아도 되며, 팀이 변경 사항과 배포 시기를 결정할 수 있다.

### 7-2. 공동 소유권

- `공동 소유권 collective ownership` 모델을 사용하면 여러 팀 중 어느 팀이든 마이크로서비스를 변경할 수 있다.
  - 주요 이점 중 하나는 필요한 곳에 인력을 배치할 수 있다는 점이다. => 인력이 병목 현상을 유발하는 경우 유용할 수 있다.
- 팀과 사람이 마이크로서비스 간에 더 자주 이동한다면 더욱 일관된 작업 수행 방식을 선택해야 한다.
  - 매주 다른 마이크로서비스에서 작업?? => 광범위한 기술 선택 & 다양한 유형의 배포 모델을 감당할 수 없다.
- 결국 공동 소유권 모델로 어느 정도 효과를 얻으려면, 결국 한 마이크로서비스에서 작업하는 것이 다른 마이크로서비스에서 하는 것과 크게 다르지 않아야 한다.
  - 일관성을 높이기 위해 **선택권을 줄여야** 할 가능성이 크다.
- 또한 개인과 개인이 속한 팀 간의 고도화된 조정을 필요로 한다.
  - 조직 레벨에서 결합이 증가되는 결과를 초래

> 강력하게 결합된 조직에서는 명시적인 관리직의 선택이 아니더라도 설계가 자연히 더 강하게 결합된다.

- 마이크로서비스는 독립적인 배포 가능성의 개념을 완전히 수용할 수 있을 때 가장 잘 작동하며, 강하게 결합된 아키텍처는 원하는 것과 반대가 된다.

### 7-3. 팀 수준 대 조직 수준

- 강력한 소유권과 공동 소유권의 개념은 다양한 조직 수준으로 적용될 수 있다.
- '다양한 기술을 갖춘 팀 polu-skilled team'은 공동 소유권을 갖는 데 매우 능숙해야 한다.
- 조직 레벨에서 팀이 고도의 자율성을 갖길 원한다면 강력한 소유권 모델을 갖는 것도 중요하다.

### 7-4. 균형 모델

- 공동 소유권을 지향할수록 일관된 작업 수행 방식을 유지하는 것이 더 중요하다. (동일한 기술 스택, 유사한 개발 관행)
- 조직이 더 강력한 소유권을 갖게 될수록 더 많은 지역적 최적화가 가능하다. (다른 기술, 다른 코딩 스타일)

## 8. 활성화 팀

- 활성화 팀은 스트림 정렬 팀을 지원하기 위해 일하는 팀이다.
- 활성화 팀은 다양한 형태와 규모로 구성될 수 있다.
  - 각 팀이 다른 프로그래밍 언어를 사용하기로 했다고 해보자. 
  - 조직 내 다양한 프로그래밍 언어 지원? => 업무 전환을 얼마나 복잡하게 만들고 채용에는 어떤 영향을 미칠까?
- 활성화 팀은 팀 외부에서 더 잘 고칠 수 있는 문제를 식별하는 데 도움이 된다.

### 8-1. 실천 공동체

- `실천 공동체 community of practice`는 동료 간의 공유와 학습을 촉진하는 교차 그룹이다.
  - 여러 팀에서 일어나느 일에 대한 통찰력을 제공한다.
  - 전역적 최적화와 지역적 최적화 사이의 균헝 조정이 필요한지 여부 파악. 중앙 조직의 추가 지원 여부를 인식.
  - 팀 그룹의 책임과 역량에 따라 구분된다.

### 8-2. 플랫폼

- 스트림 정렬 팀에게는 작업을 수행할 수 있는 셀프 서비스 도구셋이 필요하다. 이것이 바로 플랫폼이다.
  - ex. k8s

> 우리는 쿠버네티스를 사용하기 위해 조직을 변경하지 않았다.
> 실제로는 조직을 변화시키고 싶어서 쿠버네티스를 사용했다.

#### 플랫폼 팀

- 당신이 플랫폼 팀의 구성원이라면, 당신의 일은 사용자의 삶을 더 편하게 만드는 것이다.
  - 플랫폼 사용자는 다른 개발자들.
  - 사용하는 팀과 협업해 그들을 도울 뿐 아니라 피드백과 요구 사항을 수용해야 한다는 것을 의미한다.

#### 포장된 길

- `포장된 길 the paved road`은 소프트웨어 개발에서 대중화된 개념이다.
  - 작업을 수행하는 방법을 명확하게 소통한 다음 그 작업을 쉽게 수행할 수 있는 메커니즘을 제공하는 것이다.
- 포장된 길의 핵심 개념은 포장된 길의 사용을 강제하지 않는다는 것이며, 단지 목적지에 도찰하는 더 쉬운 방법을 제공할 뿐이다.
  - 플랫폼을 포장된 길로 생각한다면, 플랫폼을 의무화하지 않고 플랫폼 팀이 플랫폼을 사용하기 쉽게 만들도록 인세티브를 부여할 수 있다.
- 플랫폼을 사용하면 포장된 길 위에 있는 것이며, 많은 노력을 들이지 않고도 올바른 일을 많이 할 수 있게 된다.
- 반면, 일부 조직은 플랫폼을 통해 `통치 govern`하려고 한다.
  - 그 조직은 어떤 일을 해야 하고 왜 해야 하는지 명확하게 설명하는 대신 "이 플랫폼을 사용해야 합니다"라고만 이야기 한다.
  - 하지만 플랫폼이 특정 사례에 적합하지 않다면 사람들은 플랫폼 자체를 우회하는 방법을 찾게될 수도 있다.

## 9. 공유 마이크로서비스

### 9-1. 너무 어려운 분할

- 둘 이상의 팀이 하나의 마이크로서비스를 소유하는 이유 중 하나는 각 팀이 소유할 수 있는 조각으로 분리하는 비용이 너무 높거나 조직에서 아마도 그 가치를 제대로 파악하지 못했기 때문일 수 있다.
- 대규모 모놀리식 시스템에서 흔히 발생하는 현상이다.
  - 아키텍처 자체에 더 밀접하게 맞추기 위해 팀을 합치는 것도 고려해볼 수 있다.

### 9-2. 횡단 변경 사항

### 9-3. 전달 병목 현상

- 공동 소유권 채택 주요 이유 => 전달 병목 현상을 피하기 위해
- 병목이 생기면?
  1. 기다린다.
  2. 공동 소유권을 통해 다른 팀이 해당 서비스를 바꿀 수 있게 한다.
  3. 고려할 수 있는 다른 모델 (공유 마이크로서비스로 '플로그인')

## 10. 내부 오픈 소스

- 공유 코드베이스 문제를 관리하는 데 도움.
- 팀 외부 사람들이 사용 중인 마이크로서비스에 더 쉽게 변경 사항을 반영하도록 해주는 일종의 내부 오픈 소스를 구현.
  - 소수의 핵심 커미터.
  - 오픈 소스를 변경하려면 커미터에게 pull 요청

### 10-1. 핵심 커미터의 역할

- 고품질의 코드를 유지하고 마이크로서비스가 서로 협업하는 면에서 일관성을 유지하길 바람.
- 신뢰된 커미터와 비신뢰 커미터(팀 외부에서 변경 사항을 `submit`하는 사람들)로 구분해야 한다.
- 핵심 소유권을 가진 팀은 변경 사항을 검토하고 승인하는 방법이 필요.

### 10-2 성숙도

- 서비스가 덜 안정적이거나 덜 성숙될수록 핵심 팀 외부의 사람들이 패치를 서브밋하도록 허용하는 것은 더 어려워진다.
- 서비스의 핵심 골격이 자리를 잡기 전에 팀은 '좋은 것'이 어떤 것인지 모르기 때문에 좋은 서브밋이 어떤 것인지 알아내려고 애쓸 것이다.

### 10-3. 도구

- 내부 오픈 소스 모델을 가장 잘 지원하려면 몇 가지 도구가 필요하다.
  - pull 요청을 submit할 수 있는 기능이 포함된 분산 버전 제어 도구를 사용하는 것이 중요하다.
  - 조직의 규모에 따라 패치 요청을 논의 하고 발전시키는 도구가 필요할 수도 있다.

## 11. 플러그 가능한 모듈식 마이크로서비스

> 만약 팀이 pull 요청을 많이 받는다면 여러 팀에게 공유되는 마이크로서비스가 실제로 있다는 신호일 수 있다.

#### 소유권 변경

- 때때로 마이크로서비스의 소유자를 변경하는 것은 올바른 일.

#### 여러 가지 변형 실행

- ex. 각 국가의 팀별 변형을 운영
- 물론 이 방법의 문제는 코드 중복이다.
- 이에 대한 방안은 현재 공유 마이크로서비스를 관리하는 팀이 실제로 공통 기능망 가진 기존 마이크로서비스로 구성된 프레임워크를 대신 제공하는 것이다.
- 공통 프레임워크를 사용하면 동일한 마이크로서비스에 대한 여러 변형을 다른 팀에서 운영할 수 있다.

#### 라이브러리를 통한 외부 기여

- 미국 팀이 미국에만 해당되는 로직을 구현해야 한다면 중앙의 마이크로서비스 빌드의 일부로 포함되는 라이브러리를 변경하는 것이다.
- 이 방식은 마이크로서비스를 추가로 실행할 필요성을 줄인다.

### 11-1. 변경 사항 검토

- 내부 오픈 소스 방식을 채택할 때는 변경 사항을 승인하기 전에 변경 사항을 검토해야 한다는 `검토 review` 개념이 핵심 원칙이다.
  - pair programming을 통한 즉각 검토 방식.

> 고위험 변경만 승인받는 것은 소프트웨어 전달 성과와 상관관계가 없다는 점을 발견했다.
> 승인 프로세스가 없거나 동료가 검토하는 방식을 사용한 팀은 더 높은 소프트웨어 전달 성과를 달성했다.
> 마지막으로, 외부 기관의 승인을 필요로 하는 팀은 낮은 성과를 나타냈다.

- `동료 검토 peer review`와 외부 변경 검토 사이에 차이가 있다는 사실을 알 수 있다.
  - 외부 검토는 항상 더 어렵다.

> 시스템 내부에 정통하지 않은 외부 인원이 잠재적으로 수백 명의 엔지니어가 만든 수만 줄의 코드 변경을 검토하고 복잡한 시스템에 미치는 영향을 정확하게 판단할 가능성은 얼마나 될까?

#### 동기식 및 비동기식 코드 검토

- 페어 프로그래밍을 사용하면 코드가 작성될 때 코드 검토가 인라인으로 수행된다. 사실 그 이상이다.
- 페어링하지 않는 경우 코드를 작성한 직후 검토를 진행하는 것이 이상적이다.
  - 그런 다음 검토 자체가 가능한 한 동기화되길 원한다.
- 코드 변경에 대한 피드백을 더 빨리 받을수록 더 빨리 피드백을 살펴보고, 평가하고, 확인을 요청하며, 필요한 경우 문제를 더 깊이 논의할 수 있어 궁극적으로 어떤 필요한 변경도 수행할 수 있다.

#### 앙상블 프로그래밍

- ensenmble programming 혹은 mob programming
- 이 방법은 기본적으로 한 문제에 대해 집단적으로 작업하고 많은 개별 참여자에게서 입력을 받을 때 사용된다.
- 앙상블 내 힘의 불균형은 집단적인 문제 해결이란 목표를 더 약화시킬 것이다.

## 12. 고아 서비스

- 더 이상 적극적으로 유지 보수되지 않는 서비스.
- 여러 기술 스택을 사용하는 경우 팀이 기술 스택을 더 이상을 알지 못하면 `고아 서비스 orphaned service`를 변경하는 데 어려움이 가중될 것이다.

## 13. 사례 연구: realeastate.com.au

- 독립적인 여러 사업 분야 = LOB
- 이러한 사업 분야에는 관련 IT 제공 팀 = Squad
  - 일부 분야는 하나의 스쿼드만 존재. 큰 분야에는 여러 개의 스쿼드도 가능. 
- LOB 내부의 스쿼드는 서비스의 구축, 테스트 및 출시, 지원과 폐기. => 자신들이 만든 서비스의 전체 생명주기를 담당.
- `핵심 제공 서비스 core delivery service` 팀은 LOB의 스쿼드에 조언, 지침, 도구를 제공해 이 스쿼드들이 더 효과적으로 제공하는 데 도움을 줌.
  - 활성화 팀의 역할을 함.
  - 강력한 자동화 문화가 핵심.
  - 더 자율적인 팀이 되는 중요한 요소로 AWS를 많이 사용
- 시스템 아키텍처뿐 아니라 조직 구조도 변경할 수 있을 정도로 적응력이 뛰어난 조직은 팀의 자율성 향상과 새로운 기능의 출시 시간 단축이라는 측면에서 엄청난 이점을 얻을 수 있다.

## 14. 지리적 분포

- 같은 곳에서 일하는 팀 => 동기식 소통이 편리
- 팀이 분산 => 팀 구성원이 같은 시간대에 있다면 동기식 소통 가능.
- 팀이 분산, 다양한 시간대 => 조정 비용이 크게 상승.
  - 비동기식 소통 진행
- 팀의 지리적, 시간적 분포가 응집되어 있을수록 좋다.


## 15. 콘웨이의 역법칙

- 시스템 설계의 단점이 무엇이든 간에 변화를 만들기 위해 조직 구조를 변경해야 한다.

## 16. 사람

> 처음에 어떻게 보이든 항상 사람의 문제다.
> - 게리 웨인버그, "컨설팅의 두 번째 법칙"

- 마이크로서비스 환경
  - 네트워크 경계를 넘어선 호출과 같은 것들의 의미와 실패의 시사점을 더 잘 알고 있어야 한다.
- 자율성을 높이려고 개발 팀에 권한을 주는 것은 걱정스럽다.
  - 일 떠넘기기를 즐기던 사람들은 다른 사람에게 책임을 묻는 데 익숙하지만, 자기 일을 전적으로 책임지는 것을 불편하게 여길 것이다.
  - 변화에 대해 가장 의욕적이고 능력 있는 사람들의 책임을 바꾸는 데서 시작하는 것이 합리적이다.
- 각 조직은 고유한 역학 관계가 있다.
  - 변화에 대한 직원의 요구를 이해해야 한다. 너무 빨리 밀어붙히지 말라.
  - 하지만 일을 해내기 위해 조직에 다른 부류의 사람들이 필요하다는 사실을 받아들여야 하거나 고용 방식을 바궈야 할 수도 있다.

<br/>

# 참고 자료

- 마이크로서비스 아키텍처 구축, 샘 뉴먼 지음
