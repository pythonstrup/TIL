# Chapter 12 다형성

- 코드 재사용을 목적으로 상속을 사용하면 변경하기 어렵고 유연하지 못한 설계에 이를 확률이 높아진다.
  - 상속의 목적은 코드 재사용이 아니다.
  - 상속은 타입 계층을 구조화하기 위해 사용해야 한다.
- 상속의 관점에서 다형성이 구현되는 기술적인 메커니즘.
  - 다형성이 런타임에 메시지를 처리하기에 적합한 메소드를 동적으로 탐색하는 과정을 통해 구현되며, 상속이 이런 메소드를 찾기 위한 일종의 탐색 경로를 클래스 계층의 형태로 구현하기 위한 방법이라는 사실.


## 1. 다형성

- `다형성 polymorphism`이라는 단어는 그리스어에서 '많은'을 의미하는 'poly'와 '형태'를 의미하는 `morph`의 합성어.
  - '많은 형태를 가질 수 있는 능력'
  - 컴퓨터 과학에서는 다형성을 하나의 추상 인터페이스에 대해 코드를 작성하고 이 추상 인터페이스에 대해 서로 다른 구현을 연결할 수 있는 능력으로 정의한다.

<img src="img/polymorphism01.jpg">

- 객체지향 프로그래밍에서 사용되는 다형성은 `유니버설(Universal) 다형성 `과 `임시(Ad Hoc) 다형성`으로 분류할 수 있다.
- 유니버설 다형성은 다시 `매개변수(Parametric) 다형성`과 `포함(Inclusion) 다형성`으로 분류할 수 있다.
- 임시 다형성은 `오버로딩(Overloading) 다형성`과 `강제(Coercion) 다형성`으로 분류할 수 있다.

#### 오버로딩

- 아래와 같이 동일한 이름의 다양한 메소드가 존재하는 것을 의미한다.
  - 기억해야 하는 이름의 수를 극적으로 줄일 수 있다는 장점이 있다.

```java
public class Money {
  public Money plus(Money amount) {...}
  public Money plus(BigDecimal amount) {...}
  public Money plus(long amount) {...}
}
```

#### 강제 다형성

- 언어가 지원하는 자동적인 타입 변환이나 사용자가 직접 구현한 타입 변환을 이용해 동일한 연산자를 다양한 타입에 사용할 수 있는 방식을 가리킨다.
- 예를 들어 자바에서 이항 연산자인 '+'는 피연산자가 모두 정수일 경우에는 정수에 대한 덧셈 연산자로 동작하지만 하나는 정수형이고 다른 하나는 문자열인 경우 연결 연산자로 동작한다.
  - 정수형 피연산자는 문자열 타입으로 **강제 형변환**된다.

```java
10 + 10 // 덧셈 연산으로 동작. 결과값: 20
"10" + "10" // 연결 연산으로 동작. 결과값: "1010"
```

#### 매개변수 다형성

- `제너릭 프로그래밍 Generic Programming`과 관련이 깊다.
- 클래스의 인스턴스 변수나 메소드의 매개변수 타입을 임의의 타입으로 선언한 후 사용하는 시점에 구체적인 타입으로 지정하는 방식을 가리킨다.
- 자바의 `List`
  - 컬렉션에 보관할 요소의 타입의 임의의 타입 T로 지정
  - 실제 인스턴스를 생성하는 시점에 T를 구체적인 타입으로 지정할 수 있게 하고 있다.
  - 따라서 다양한 타입의 요소를 다루기 위해 동일한 오퍼레이션을 사용할 수 있다.

```java
public interface List<E> extends SequencedCollection<E> {...}
```

```java
List<String> string = new ArrayList<>();
List<Integer> integer = new ArrayList<>();
List<Member> members = new ArrayList<>();        
```

#### 포함 다형성

- 메시지가 동일하더라도 수신한 객체의 타입에 따라 실제로 수행되는 행동이 달라지는 능력을 의미.
- `서브타입(Sybtype) 다형성`이라고도 부른다.
- 객체지향 프로그래밍에서 가장 널리 알려진 형태의 다형성이기 때문에 특별한 언급 없이 다형성이라고 할 때는 포함 다형성을 의미하는 것이 일반적이다.
- `Movie` 클래스의 예시
  - `Movie` 클래스는 `discountPolicy`에게 `calculateDiscountAmount` 메시지를 전송하지만 실제로 실행되는 메서드는 메시지를 수신한 객체의 타입에 따라 달라진다.

```java
public class Movie {
  private DiscountPolicy discountPolicy;
  
  public Money calculateMoveiFee(Screening screening) {
    return fee.minus(discountPolicy.calculateDiscountAmount(screening));
  }
}
```

- 포함 다형성을 구현하는 가장 일반적인 방법은 상속을 사용하는 것이다.
- 포함 다형성을 서브타입 다형성이라고 부른다는 사실에서 예상할 수 있겠지만 포함 다형성을 위한 전제조건은 자식 클래스가 부모 클래스의 서브타입이어야 한다는 것이다.
  - 그리고 상속의 진정한 목적은 코드 재사용이 아니라 다형성을 위한 서브타입 계층을 구축하는 것이다.
- 상속의 일차적인 목적은 코드 재사용이 아니라 서브타입의 구현이다.
- 포함 다형성을 위해 상속을 사용하는 가장 큰 이유는 상속이 클래스들을 계층으로 쌓아 올린 후 상황에 따라 적절한 메소드를 선택할 수 있는 메커니즘을 제공하기 때문이다.
  - 객체가 메시지를 수신하면 객체지향 시스템은 메시지를 처리할 적절한 메서드를 상속 계층 안에서 탐색한다.
  - 실행할 메서드를 선택하는 기준은 어떤 메시지를 수신했는지에 따라, 어떤 클래스의 인스턴스인지에 따라, 상속 계층이 어떻게 구성돼 있는지에 따라 달라진다.



<br/>

# 참고자료

- 오브젝트, 조영호 지음
